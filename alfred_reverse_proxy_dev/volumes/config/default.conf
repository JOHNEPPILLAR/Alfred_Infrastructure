server {
    listen                  3979 ssl;
    server_name             alfred_health_service;
    ssl_certificate         /etc/ssl/private/server.pem;
    ssl_certificate_key     /etc/ssl/private/server.key;

   location / {
        set $upstream        alfred_health_service:3978;
        resolver             127.0.0.11;
        proxy_pass           https://$upstream;
        proxy_set_header     Host $host;
        proxy_set_header     X-Real-IP $remote_addr;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Forwarded-Proto $scheme;
    }
}

server {
    listen                  3979 ssl;
    server_name             alfred_weather_service;
    ssl_certificate         /etc/ssl/private/server.pem;
    ssl_certificate_key     /etc/ssl/private/server.key;

   location / {
        set $upstream        alfred_weather_service:3978;
        resolver             127.0.0.11;
        proxy_pass           https://$upstream;
        proxy_set_header     Host $host;
        proxy_set_header     X-Real-IP $remote_addr;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Forwarded-Proto $scheme;
    }
}

server {
    listen                  3979 ssl;
    server_name             alfred_netatmo_data_collector_service;
    ssl_certificate         /etc/ssl/private/server.pem;
    ssl_certificate_key     /etc/ssl/private/server.key;

   location / {
        set $upstream        alfred_netatmo_data_collector_service:3978;
        resolver             127.0.0.11;
        proxy_pass           https://$upstream;
        proxy_set_header     Host $host;
        proxy_set_header     X-Real-IP $remote_addr;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Forwarded-Proto $scheme;
    }
}

server {
    listen                  3979 ssl;
    server_name             alfred_dyson_data_collector_service;
    ssl_certificate         /etc/ssl/private/server.pem;
    ssl_certificate_key     /etc/ssl/private/server.key;

   location / {
        set $upstream        alfred_dyson_data_collector_service:3978;
        resolver             127.0.0.11;
        proxy_pass           https://$upstream;
        proxy_set_header     Host $host;
        proxy_set_header     X-Real-IP $remote_addr;
        proxy_set_header     X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header     X-Forwarded-Proto $scheme;
    }
}

server {
    listen                  3979 ssl;
    server_name             localhost;
    ssl_certificate         /etc/ssl/private/server.pem;
    ssl_certificate_key     /etc/ssl/private/server.key;

    location /health/ {
        set $alfred_health_service  alfred_health_service:3978;
        resolver                    127.0.0.11;
        rewrite                     /health/(.*) /$1 break;
        proxy_pass                  https://$alfred_health_service;
        proxy_set_header            Host $host;
        proxy_set_header            X-Real-IP $remote_addr;
        proxy_set_header            X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header            X-Forwarded-Proto $scheme;
    }

   location /netatmo/ {
        set $alfred_netatmo_data_collector_service  alfred_netatmo_data_collector_service:3978;
        resolver                                    127.0.0.11;
        rewrite                                     /netatmo/(.*) /$1 break;
        proxy_pass                                  https://$alfred_netatmo_data_collector_service;
        proxy_set_header                            Host $host;
        proxy_set_header                            X-Real-IP $remote_addr;
        proxy_set_header                            X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header                            X-Forwarded-Proto $scheme;
    }

   location /dyson/ {
        set $alfred_dyson_data_collector_service alfred_dyson_data_collector_service:3978;
        resolver            127.0.0.11;
        rewrite             /dyson/(.*) /$1 break;
        proxy_pass          https://$alfred_dyson_data_collector_service;
        proxy_set_header    Host $host;
        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto $scheme;
    }

    location /weather/ {
        set $alfred_weather_service https://alfred_weather_service:3978;
        resolver            127.0.0.11;
        rewrite             /weather/(.*) /$1 break;
        proxy_pass          $alfred_weather_service;
        proxy_set_header    Host $host;
        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto $scheme;
    }

    location /flowercare/ {
        set $alfred_flowercare_data_collector_service 192.168.85.13:3981;
        resolver            127.0.0.11;
        rewrite             /flowercare/(.*) /$1 break;
        proxy_pass          https://$alfred_flowercare_data_collector_service;
        proxy_set_header    Host $host;
        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto $scheme;
    }
}
